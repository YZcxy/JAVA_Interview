# 计算机网络知识点

## 概述

Q：计算机网络的分类？  
A：按照网络作业的**范围**分类：广域网(WAN)、城域网(MAN)、局域网(LAN)。按照网络作用的**使用者**分类：公用网络和专用网络。  
***
Q：互联网的发展历史？  
A：可以分为三个阶段：  
- 单个网络ARPANET：这个阶段主要是一些计算机通过交换机进行连接，这个时候计算机通过连接交换机，就可以直接完成信息的交换，并且连接的计算机不多。  
- 三级结构互联网：这个阶段主要连接的是全美国主要的一些学校、研究所、实验室等拥有计算机的地方  
- 多层次ISP互联网：由ISP（Internet Service Provider）提供网络服务，用户可以自主选择接入互联网。  
***
Q：为什么100M光纤，网速只有12M每秒？  
A：因为 100M/s = 100Mbps = 100Mbit/s，因此 100Mbit/s = (100/8)MB/s = 12.5MB/s。  
***
Q：网络时延的分类？  
A：大体可以分为四类：  
- 发送时延：主要是本机进行网络发送的时候，在本机停留的时间。
- 排队时延：数据包在网络设备中等待被处理的时间。
- 传播时延：数据包在传输介质(铜线、光纤)中的消耗时间。
- 处理时延：数据包到达设备后被处理锁需要的实际。
***
Q：RRT是什么？  
A：RTT（Route-Trip Time）是评估网络质量的一项重要指标，RTT表示的是数据报文在端到端通信中的来回一次的时间，可以使用 ping 命令查看RTT。  
***
Q：什么是OSI七层模型？  
A：OSI 七层模型在制定的时候，是想成为全球计算机都遵循的标准，但是在市场化过程中困难重重。TCP/IP 模型在全球范围内成功的运行了。  
- 应用层(数据)：确定进程之间通信的性质，提供网络与用户应用。  
- 表示层(数据)：主要解决用户信息的语法表示问题，如加解密。  
- 会话层(数据)：提供访问验证和会话管理服务，建立和维护应用之间通信的机制。  
- 传输层(段)：实现网络不同主机上用户进程之间的数据通信，可靠。  
- 网络层(包)：提供逻辑地址(IP)、选路，数据从源端到目的端的传输。  
- 数据链路层(帧)：使用MAC地址访问媒介，错误检测与修正。  
- 物理层(比特流)：设备之间比特流的传输，物理接口。  
![osi7](https://static001.geekbang.org/infoq/c5/c5aa89b0647c77de178d4a605e593c74.png) 
***
Q：什么是TCP/IP四层模型？  
A：TCP/IP 模型是OSI的简化版，只包括网络接口层、网络层、传输层和应用层。  
![TCP/IP](https://static001.geekbang.org/infoq/ce/ce5d6c878b5f7710607f5fcd3fa99cd9.png)
***
Q：TCP/IP四层模型的实际应用？  
A：如下图：  
![app](https://static001.geekbang.org/infoq/f7/f77e6101943a167966c405792db80fc1.png)  
除此之外，还可以通过分层的方法去理解不同的层面  
![level](https://static001.geekbang.org/infoq/34/34950fe99aaef114a420268cdf220268.png)
***

## 物理层

Q：物理层的作用是什么？  
A：物理层主要是为了连接不同的物理设备，比如路由器到计算机之间使用网线连接。然后在线路中传输比特流。  
***
Q：有哪些传输介质？  
A：可分为有线介质和无线介质。其中有线介质包括双绞线、同轴电缆、光纤等。无线介质包括红外线、无线、激光等。  
***
Q：什么是信道？  
A：信道是信号在通信系统中传输的通道。一条通信电路往往包含一个接收信道和一个发送信道，因为发送信息和接收信息的方向不一样，所有这里有两个信道。  
***
Q：信道的分类？  
A：一般可以分为三类：  
- 单工通信信道：只能单向通信，没有反方向反馈的信道。  
- 半双工通信信道：在同一个信号载体上，可以向两个方向传输，但是不能同时传输。  
- 全双工通信信道：在发送数据的同时，也能够接受数据，二者同步进行。  
***
Q：什么是信道复用技术？  
A：如果两台计算机需要通信，就需要有一条信道的存在。如果有很多计算机，不可能为每两者之间都分配一条独立信道。所以信道需要复用和分用。  
![xd](https://static001.geekbang.org/infoq/de/de7cfe45a31148f5bb6fc4de786682d4.png)  
***

## 数据链路层

Q：数据链路层的作用？  
A：数据链路层接管数据报，并将它封装成帧。同时提供透明传输和差错检查的功能。  
***
Q：什么是透明传输？  
A：数据链路层封装成帧，会给数据在前后增加帧的头部和尾部，但是为了不让接收端将位于数据中和控制符一样的字符误认为控制符，需要给数据内的控制符添加一个转义字符。对于上层API是透明操作，无感知的。  
![zy](https://static001.geekbang.org/infoq/4e/4e540e5cf157713f73a2df788945a53f.png)  
***
Q：什么是差错检测？  
A：因为物理层只负责传输比特流，无法控制数据是否出错。数据链路层就担负起了差错检测的功能，差错检测一般包含以下两个部分：  
- 奇偶校验码：奇偶校验码通过在数据流后面添加一位比特位来标识数据中1的个数是奇数还是偶数，例如 `00110010` 这样的数据，奇偶校验码就是 1 。但是奇偶校验码在出现了两位错误的时候，就检测不到错误了。  
- 循环冗余校验：循环冗余校验码是一种广泛使用的差错检测的算法，它是一种根据传输或保存的数据而产生固定位数校验码的方法，当接收端接收到数据之后，就会根据附加到后边的数字，来判断接收到的数据是否有出错。  
***
Q：什么是MAC地址？  
A：MAC 地址也被叫做物理地址，每一个物理设备都拥有唯一的一个 MAC 地址，MAC地址共48位(6个字节)，通常用十六进制表示。  
***
Q：什么是以太网协议？  
A：以太网是一种应用于数据链路层的协议，广泛运用于局域网技术。以太网的数据格式如下：  
![ytw](https://static001.geekbang.org/infoq/e9/e9b4bb3a64bda9023ad85b347e9b80af.png)  
- 目的地址、源地址：其中就是 6 个字节的 MAC 地址。  
- 类型：表示帧数据是哪个协议的数据，如果是网络层的数据就是0800，如果是 ARP 请求，就是0806，如果是 RARP 协议，就是8035。  
- 帧数据：具体的数据。  
- CRC：就是差错检测的循环冗余校验码。  
***
Q：什么是MAC地址表？  
A：MAC 地址表示一个映射，会把 MAC 地址具体映射到硬件的接口上。  
如果局域网内A想要访问B，就会优先去查 MAC 地址表，如果映射不存在，就会发起广播，收到B的回复后，就会将映射存入 MAC 地址表。  
***

## 网络层

Q：什么是IP地址？  
A：IP 地址是指互联网协议地址，是 IP 协议提供的一种统一的地址格式，它为互联网上的每一个网络和每一台主机分配一个逻辑地址，以此来屏蔽物理地址的差异。IP地址长度为32位，占4个字节。  
***
Q：IP地址的分类？  
A：IP 地址编址方案将 IP 地址空间划分为五类：  
- A类地址：首位是0，第一个字节范围：0~127。
- B类地址：前两位是10，第一个字节范围：128~191。
- C类地址：前三位是110，第一个字节范围：192~223。
- D类地址：前四位是1110，第一个字节范围：224~239。
- E类地址：前四位是1111，保留地址。
其中 A、B、C 是基本类，D 和 E 是特殊地址，作为多播和保留使用。  
***
Q：IP地址和MAC地址的区别？  
A：主要有以下区别：  
- MAC 地址是数据链路层和物理层使用的地址。  
- IP 地址是网络层及以上各层使用的地址，是一种逻辑地址。  
- MAC 地址唯一，不可改变；IP 地址随着网络环境改变。  
***
Q：什么是IP协议？  
A：在物理层，传输着0、1这样的比特流；在数据链路层，传输的是数据帧；在网络层，传输的就叫做 IP 数据报，其中 IP 数据报包含了 IP 首部和数据两个部分。  
![ip](https://static001.geekbang.org/infoq/41/418cdf92105d9164fedf5dd8a1ffc77e.png)  
***
Q：什么是IP首部？  
A：IP协议的首部非常重要，包含格式如下：  
![sb](https://static001.geekbang.org/infoq/0b/0b2618dc8c86b98de76118c1def17c15.png)  

- 版本：占4位，指的是 IP 协议的版本，通信双方的版本必须一致。
- 首部长度：占4位，表示IP首部的长度，最大数值为15，单位是4字节，所以IP首部最长60字节。
- 服务类型：占8位，一般不太关心。
- 总长度：占16位，表示 IP 数据报的总长度，包括了 IP 数据部分。最大值为65535，表示65535字节，远大于数据链路层数据帧的大小，所以在传输中会对IP数据报进行**切片**。
- 标识：无需关心。
- 标记：标记IP报文是否可以进行切片。
- 片偏移：如果 IP 数据报被切片，那么需要用到片偏移来记录当前是第几个偏移的 IP 数据报。
- TTL：占8位，表示 IP 数据报在网络中的**寿命**，每经过一个设备就减一，当 TTL=0 时就会丢弃这个报文，防止报文无限传输。
- 协议：占8位，表示 IP 数据报所携带的具体数据是什么协议(ICMP，TCP，UDP等)。
- 校验和：占16位，校验 IP 首部是否有出错。  
- 源IP地址：发送方的 IP 地址。
- 目的IP地址：想要达到的目的网络设备 IP 地址。 
***
Q：什么是ARP协议？  
A：ARP 协议完成了 IP 地址和物理地址的映射。每台主机都有自己的 ARP 列表(包括交换机)，当源主机需要将一个数据包发送时，会首先检查自己的 ARP 列表中是否存在该 IP 地址的映射。  
- 如果有，就直接将该数据包发送到这个 MAC 地址。  
- 如果没有，就向本地网段发起一个 ARP 请求的广播，查询此 IP 对应的 MAC地址，网络中的所有主机会检查数据包中的目的 IP 是否和自己的 IP 地址一致。  
  - 如果都不一致，就忽略了此包
  - 如果相同，该主机首先将发送端的 MAC 地址和 IP 地址添加到本地的 ARP 表，然后回送给源主机一个 ARP 响应包。
    - 源主机收到了 ARP 响应包，就跟新自己的 ARP 表，然后利用此信息进行传输。
    - 如果源主机一直没有收到 ARP 响应包，表示 ARP 查询失败。  
***
Q：ARP协议的报文信息？  
A：ARP协议的报文信息是直接封装到数据链路层的数据帧中的。  
![arp](https://static001.geekbang.org/infoq/96/964899d2ce7d3756a5a0a66635c3cbc2.png)
***
Q：什么是RARP协议？  
A：RARP（Reverse Address Resolution Protocol）逆地址解析协议，就是做 ARP 相反的工作，可以将 MAC 地址转换为 IP 地址。  
***
Q：什么是回环地址？  
A：127.0.0.1 通常被称为本地回环地址，不属于任何一个有类别的地址，代表着本地虚拟的接口。通常在安装网卡前就可以 ping 通这个地址，可以用来检查本地网络协议，基本数据接口是否正常。  
***
Q：如何划分子网？  
A：划分子网（变长子网掩码 VLSM）：划分子网的方法是从网络的主机号借用若干位作为子网号 subnet-id ，与此同时主机号也减少相应位数（总位数 32 位不变）。  
由此两级 IP 地址可变为三级 IP 地址：IP地址 ::= {<网络号>,<子网号>,<主机号>} ，划分子网只是把 IP 地址的主机号这部分进行再划分，并不改变 IP 地址原来的网络号。  

***
Q：如何划分超网？  
A：构造超网（无分类编址 CIDR）：CIDR 消除了传统的 A 类、B 类和 C 类地址以及划分子网的概念，把 32 位的 IP 地址划分为两个部分。  
例如：128.14.35.7/20 是某个 CIDR 地址块中的一个地址，其前 20 位是网络前缀（用下划线表示的部分），后面的 12 位为主机号  
***
Q：子网掩码的作用？  
A：子网掩码只有一个作用，就是将某个 IP 地址划分成网络地址和主机地址两部分。子网掩码只有一个作用，就是将某个 IP 地址划分成网络地址和主机地址两部分。  
***
Q：ping 的原理是什么？  
A：ping 是基于 ICMP 协议工作的，全称 Internet Control Message Protocol，也就是互联网控制报文协议。ICMP 协议可以报告**错误信息**或者**异常情况**。  
***
Q：什么是 Traceroute ？  
A：Traceroute ，是用来侦测主机到目的主机之间所经路由情况的重要工具。首先计算机A发送了一个 TTL=1 的报文之后，到达中型网络之后就会发现 TTL=0 了，此时就会往源机器(也就是A)发出一个ICMP差错不可达报文。然后计算机A就发送一个 TTL=2 的报文，以此类推，就获得了路径上所有的信息。  
***

## 传输层

Q：什么是TCP协议？  
A：TCP（Transmission Control Protocol：传输控制协议），是一种面向**连接**的，可靠的，基于**字节流**的传输层通信协议。主要特点如下：  
- TCP 是面向连接的。  
- 每一条 TCP 连接只能有两个端点，点对点传输。  
- TCP 是全双工通信，双方都有缓存用于存储通信数据。  
- 面向字节流。  
***
Q：TCP上层对应的协议有哪些？  
A：有如下：  
- FTP：文件传输协议，使用21端口。
- Telnet：远程登录协议。
- SMTP：简单邮件传送协议。
- POP3：和SMTP对应，POP3用于接收邮件。
- HTTP：Web 服务器超文本传输协议。
***
Q：面向报文和面向字节流的区别？  
A：UDP 协议面向报文，因此上层应用程序必须控制报文的大小，若报文太长，需要 IP 层来进行分片，效率很低。TCP 协议面向字节流，虽然应用程序和 TCP 交互式一次一个数据块(大小不等)，但是 TCP 把应用程序看成是一连串无结构的字节流，TCP 有缓冲区，可以自由安排报文大小。  
***
Q：什么是 TCP 三次握手？  
A：描述如下：  
- 第一次握手：Client 将标志位 `SYN=1` ，随机产生一个值 `seq=J` ，并将该数据包发送给 Server 。此时，Client 进入 SYN_SENT 状态，等待 Server 确认。
- 第二次握手：Server 收到数据包后由标志位 `SYN=1` 知道Client请求建立连接，Server 将标志位 SYN 和 ACK 都置为 1 ，`ack=J+1`，随机产生一个值 `seq=K` ，并将该数据包发送给 Client 以确认连接请求，Server 进入 SYN_RCVD 状态。
- 第三次握手：Client 收到确认后，检查 ack 是否为 J+1 ，ACK 是否为 1 。
  - 如果正确，则将标志位 ACK 置为 1 ，`ack=K+1` ，并将该数据包发送给 Server 。此时，Client 进入 ESTABLISHED 状态。
  - 如果正确，则将标志位 ACK 置为 1 ，`ack=K+1` ，并将该数据包发送给 Server 。此时，Client 进入 ESTABLISHED 状态。
![tcp](http://static.iocoder.cn/04edb57536fc9bbd3ea096cafa5d3630)  
***
Q：为什么 TCP 连接需要三次握手？  
A：如果只有一次或者两次握手，Server 收到了报文，并且返回了报文。但是这个报文可能是**已经失效的连接请求**，Client 端这会并不打算建立请求，Server 端就会浪费资源一直等待。  
***
Q：什么是 TCP 四次挥手？  
A：描述如下：  
- 第一次挥手：Client 发送一个 `FIN=M` ，用来关闭 Client 到 Server 的数据传送。此时，Client 进入 FIN_WAIT_1 状态。  
- 第二次挥手，Server 收到 FIN 后，发送一个 ACK 给 Client ，确认序号为 `M+1`（与 SYN 相同，一个 FIN 占用一个序号）。此时，Server 进入 CLOSE_WAIT 状态。注意，TCP 链接处于半关闭状态，即客户端已经没有要发送的数据了，但服务端若发送数据，则客户端仍要接收。  
- 第三次挥手，Server 发送一个 `FIN=N` ，用来关闭 Server 到 Client 的数据传送。此时 Server 进入 LAST_ACK 状态。  
- 第四次挥手，Client 收到 FIN 后，此时 Client 进入 TIME_WAIT 状态。接着，Client 发送一个 ACK 给 Server ，确认序号为 `N+1` 。Server 接收到后，此时 Server 进入 CLOSED 状态，完成四次挥手。  
![tcp2](http://static.iocoder.cn/2cf7b8d1689ae6e920ef1b2c3eafb8b2)  
***
Q：为什么 TCP 断开需要四次挥手？  
A：因为 TCP 是全双工通信模式，Client 发起断开请求，表示的是 Client 已经没有信息要发送了。但是此时 Server 端还可以继续发送，并且 Client 也能接收得到。当第三次挥手 Server 发起了断开请求，Client 同意之后，才真正的断开连接。  
***
Q：TCP 数据如何传输？  
A：如下实例：主机 A 分两次向主机 B 传递了 200 字节的过程。  
![tcp3](http://static.iocoder.cn/6ed78395a32a0fbf56afed309dc1eb71)  
1. 首先主机 A 通过一个数据包发送了 100 个字节的数据，数据包的 `Seq=1200`。主机 B 为了确认数据包是否正确，向主机 A 回复了 `ACK=1301`。  
2. 主机 A 收到了主机 B 的回复，验证 `1301=1200+100(数据包大小)+1 `正确，因此判断主机 B 已经正确接收到了数据包。  
3. 主机 A 再次发送 100 个字节的数据包，`Seq=1301`。主机 B 如果正确接收，同上原理回复`ACK=1402`。  
4. 主机A收到回复并验证正确，`1402=1301+100(数据包大小)+1` 传输结束。  
***
Q：TCP 数据传输丢失怎么办？  
A：由于各种原因，TCP 数据包有可能存在丢失的情况，TCP 因此会进行重传操作：  
![tcp4](http://static.iocoder.cn/a36ed3dad53b9b4439bc8156bc63a2c0)  
- 上图表示 `Seq=1301` 这个数据包丢失了，因此主机 B 不会回复  `ACK`，主机 A 迟迟等不到回复，就会尝试重传。  
- TCP 套接字每次发送数据包都会启动定时器，一定时间没有收到回复便会重传，重传超时时间使用了**自适应的动态算法**，正常情况下，数据包只会被重传 3 次，如果有些要求很高的业务系统，可能会不断重传。  
- 发送端只有在收到了 `ACK` 之后才会清空缓冲区，所以支持一直重传。  
***
Q：什么是 TCP 滑动窗口？  
A：滑动窗口协议，是传输层进行流控的一种措施，接收方通过通告发送方自己的窗口大小，从而控制发送方的发送速度，从而达到防止发送方发送速度过快而导致自己被淹没的目的。TCP 的滑动窗口解决了端到端的流量控制问题，允许**接受方对传输进行限制**，直到它拥有足够的缓冲空间来容纳更多的数据。  
![tcp4](https://images2015.cnblogs.com/blog/821276/201510/821276-20151016204148366-1896687312.png)  
- 首先发送方第一次发送数据的窗口根据链路带宽来决定的。这里我们假设是3。
- 这里接收方回复的是 `ACK=3`，表示期望收到的下一个字节是 3。那就表示接收方的窗口是 2，下一次发送窗口就可以变成 2，从第 3 个字节开始发送。  
- 当接收方网络畅通之后，接收方能回复更大的 `ACK`，就会动态调整滑动窗口的大小。  
这其中 `ACK` 有两重认识，第一种就是回复 `ACK` 表示自己想要接受的下一字节序列号。第二种就是可以推算出接收方当前滑动窗口的大小。  
***
Q：TCP协议如何保证传输的可靠性？  
A：TCP 通过以下方式进行保障：  
- 数据包校验：目的是检测数据在传输过程中的任何变化，若校验出错，则丢弃报文不响应，发送端检测超时后会重发数据。  
- 对失序数据包重排序：TCP 报文会作为 IP 数据报来传输，而 IP 数据报的到达有可能失序，因此 TCP 报文段的到达也可能失序，TCP 会对失序数据重排序。  
- 丢弃重复数据：对于重复数据，能够丢弃报文。  
- 应答机制：当 TCP 收到发自 TCP 连接另一端的数据，它将发送一个确认。这个确认不是立即发送，通常将推迟几分之一秒。  
- 超时重发：当 TCP 发出一个段后，它启动一个定时器，等待目的端确认收到这个报文段。如果不能及时收到一个确认，将重发这个报文段。  
- 流量控制：TCP 连接的每一方都有固定大小的缓冲空间。TCP 的接收端只允许另一端发送接收端缓冲区所能接纳的数据，这可以防止较快主机致使较慢主机的缓冲区溢出，这就是流量控制。TCP 使用的流量控制协议是可变大小的滑动窗口协议。  
***
Q：怎么解决 TCP 拥堵？  
A：拥塞控制的方法主要有以下四种：  
- 慢开始：不要一开始发送大量数据，先测探下网络的拥塞程度。  
- 拥塞避免：拥塞避免算法，让拥塞窗口缓慢增长，每次只加1。  
- 快重传：发送方只要一连收到三个重复确认，就应当立即重传对方尚未收到的报文段。  
- 快恢复：当发送方连续收到三个重复确认时，就执行“乘法减小”算法，把 ssthresh 门限减半。 
***
Q：UDP协议是什么？  
A：UDP（User Data Protocol，用户数据报协议），有以下特点：  
- 无连接
- 尽最大努力交付，不保证可靠性
- 面向报文传输
- 没有拥塞控制
- 支持一对一，一对多，多对一，多对多交互
- 首部开销小，只有8个字节
***
Q：UDP 上层对应的协议有哪些？  
A：有如下：  
- DNS：用于域名解析服务，使用53端口。
- SNMP：简单网络管理协议，使用161端口。
- TFTP：简单文件传输协议。
***
Q：TCP协议和UDP协议的区别？  
A：区别如下：  
![tcpudp](http://static.iocoder.cn/047b5c455b1153e895df36e364134fcd)  
***
Q：DNS是什么？  
A：域名解析协议，可以将`www.xxx.com`域名转换为对应的 IP。  
***
Q：主机解析域名的顺序是什么？  
A：有如下四步：  
1. 浏览器缓存。
2. 本机 hosts 文件
3. 路由缓存
4. 查找 DNS 服务器
